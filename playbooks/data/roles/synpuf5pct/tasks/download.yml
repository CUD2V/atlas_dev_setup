---

- name: install packages
  apt:
    name:
    - zip
    - unzip
    state: latest
    update_cache: true

- name: create synpuf5pct dir
  file:
    dest: "{{ data_download_dir }}/{{ data_dataset }}"
    state: directory

- name: download synpuf5pct file
  script: "{{role_path}}/files/synpuf5_downloader.sh"
  args:
    chdir: "{{ data_download_dir }}/{{ data_dataset }}"
    creates: "{{ data_download_dir }}/{{ data_dataset }}/synpuf5pct_20180710.zip"

- name: extract synpuf5pct file
  unarchive:
    src: "{{ data_download_dir }}/{{ data_dataset }}/synpuf5pct_20180710.zip"
    remote_src: yes
    dest: "{{ data_download_dir }}/{{ data_dataset }}"
    creates: "{{ data_download_dir }}/{{ data_dataset }}/README.md"

# synpuf5pct includes vocabulary files.
# It's assumed this is downloaded / loaded separately
# so remove the vocabulary related files
#- name: remove duplicated vocab files
#  shell: "find {{ data_download_dir }}/vocabulary/*.csv -type f -print0 | xargs -0 -n1 basename | tr '[:upper:]' '[:lower:]'"
#  register: vocab_filename
#
#- name: print filename
#  debug: msg={{ vocab_filename }}
#
#- name: vocab is included with this dataset, so remove duplicate files
#  file:
#    path: "{{ data_download_dir }}/{{ data_dataset }}/{{item}}"
#    state: absent
#  with_items:
#  - "{{ vocab_filename.stdout }}"
